version: '3'
services:
    source:
        image: cloudproto/sensor:latest
        depends_on:
            - gateway
        restart: always
#        command: ["./wait-for-it.sh", "gateway:50051", "--", "./smemu", "-sourceFolder", "data/20170210", "-targetAddress", "gateway:50051" , "-targetType", "grpc-pipeline"]
        command: [ "sh", "-c", "sleep 10 && ./smemu -sourceFolder data/20170210 -targetAddress gateway:50051 -targetType grpc-pipeline" ]
    gateway:
#       use the local build image
#       image: pipeline_java:latest

#       use the deployed image
        image: pipeline_java:latest
        environment:
            - "ARGUMENTS=--port 50051 --host_next endpoint --port_next 50051"
        depends_on:
            - endpoint
    endpoint:
#       use the local build image
#       image: pipeline_java:latest

#       use the deployed image
       image: pipeline_java:latest
       environment:
           - "ARGUMENTS=--port 50051 --verbose"
